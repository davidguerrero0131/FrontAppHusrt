<app-industriales-navbar></app-industriales-navbar>
<div class="container-fluid p-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
                <i class="bi bi-file-earmark-text me-2"></i>Hoja de Vida Industrial
            </h3>
            <button class="btn btn-light btn-sm" (click)="regresar()">
                <i class="bi bi-arrow-left me-2"></i>Regresar
            </button>
        </div>

        <div class="card-body" *ngIf="loading">
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-2 text-muted">Cargando información...</p>
            </div>
        </div>

        <div class="card-body" *ngIf="!loading && equipoInfo">
            <!-- SECCION 1: DATOS DEL EQUIPO -->
            <div class="mb-5">
                <h4 class="text-primary border-bottom pb-2 mb-3">Información del Equipo</h4>
                <div class="row">
                    <div class="col-md-3 mb-2"><strong>Nombre:</strong> {{ equipoInfo.nombre }}</div>
                    <div class="col-md-3 mb-2"><strong>Marca:</strong> {{ equipoInfo.marca }}</div>
                    <div class="col-md-3 mb-2"><strong>Modelo:</strong> {{ equipoInfo.modelo }}</div>
                    <div class="col-md-3 mb-2"><strong>Serie:</strong> {{ equipoInfo.serie }}</div>
                    <div class="col-md-3 mb-2"><strong>Placa:</strong> {{ equipoInfo.placa }}</div>
                    <div class="col-md-3 mb-2"><strong>Ubicación:</strong> {{ equipoInfo.ubicacion }}</div>
                    <div class="col-md-3 mb-2"><strong>Tipo de Equipo:</strong> {{ equipoInfo.tipoEquipoInd?.nombres }}
                    </div>
                    <div class="col-md-3 mb-2"><strong>Servicio:</strong> {{ equipoInfo.servicioInd?.nombres }}</div>
                    <div class="col-md-3 mb-2"><strong>Sede:</strong> {{ equipoInfo.sedeInd?.nombres }}</div>
                    <div class="col-md-3 mb-2"><strong>Responsable:</strong> {{ equipoInfo.responsableInd?.nombres }}
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- SECCION 2: HOJA DE VIDA (ADQUISICION) -->
                <div class="col-md-6 mb-4" *ngIf="hojaVida">
                    <div class="card h-100">
                        <div class="card-header bg-light"><strong>Adquisición y Garantía</strong></div>
                        <div class="card-body">
                            <p><strong>Forma de Adquisición:</strong> {{ hojaVida.adquisicion }}</p>
                            <p><strong>Fecha Compra:</strong> {{ hojaVida.fechaCompra | date:'dd/MM/yyyy' }}</p>
                            <p><strong>Fecha Instalación:</strong> {{ hojaVida.fechaInstalacion | date:'dd/MM/yyyy' }}
                            </p>
                            <p><strong>Inicio Operación:</strong> {{ hojaVida.fechaInicioOperacion | date:'dd/MM/yyyy'
                                }}</p>
                            <p><strong>Vencimiento Garantía:</strong> {{ hojaVida.vencimientoGarantia |
                                date:'dd/MM/yyyy' }}</p>
                            <p><strong>Referencia:</strong> {{ hojaVida.referencia }}</p>
                            <p><strong>Fabricación:</strong> {{ hojaVida.fabricacion }}</p>
                        </div>
                    </div>
                </div>

                <!-- SECCION 3: PROVEEDOR -->
                <div class="col-md-6 mb-4" *ngIf="proveedor">
                    <div class="card h-100">
                        <div class="card-header bg-light"><strong>Proveedor y Fabricante</strong></div>
                        <div class="card-body">
                            <p><strong>Código Equipo (Prov):</strong> {{ proveedor.codigoEquipo }}</p>
                            <p><strong>Código Int. (Prov):</strong> {{ proveedor.codigoInternacional }}</p>
                            <p><strong>Fabricante:</strong> {{ proveedor.fabricante }}</p>
                            <p><strong>Ciudad (Fab):</strong> {{ proveedor.ciudadFabricante }}</p>
                            <p><strong>Representante:</strong> {{ proveedor.representante }}</p>
                            <p><strong>Teléfono (Rep):</strong> {{ proveedor.telefonoRepresentante }}</p>
                            <hr>
                            <p><strong>Distribuidor:</strong> {{ proveedor.distribuidor }}</p>
                            <p><strong>Ciudad (Dist):</strong> {{ proveedor.ciudadDistribuidor }}</p>
                            <p><strong>Teléfono (Dist):</strong> {{ proveedor.telefonoDistribuidor }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- SECCION 4: DATOS TÉCNICOS -->
                <div class="col-md-6 mb-4" *ngIf="datosTecnicos">
                    <div class="card h-100">
                        <div class="card-header bg-light"><strong>Datos Técnicos</strong></div>
                        <div class="card-body">
                            <p><strong>Volt. Operación:</strong> {{ datosTecnicos.volMaxOperacion }} - {{
                                datosTecnicos.volMinOperacion }}</p>
                            <p><strong>Corriente:</strong> {{ datosTecnicos.corrienteMaxOperacion }} - {{
                                datosTecnicos.corrienteMinOperacion }}</p>
                            <p><strong>Potencia:</strong> {{ datosTecnicos.potenciaConsumida }}</p>
                            <p><strong>Frecuencia:</strong> {{ datosTecnicos.frecuencia }}</p>
                            <p><strong>Presión:</strong> {{ datosTecnicos.presion }}</p>
                            <p><strong>Velocidad:</strong> {{ datosTecnicos.velocidad }}</p>
                            <p><strong>Temperatura:</strong> {{ datosTecnicos.temperatura }}</p>
                            <p><strong>Peso:</strong> {{ datosTecnicos.peso }}</p>
                            <p><strong>Capacidad:</strong> {{ datosTecnicos.capacidad }}</p>

                            <!-- Accesorios -->
                            <div
                                *ngIf="datosTecnicos.accesorios || datosTecnicos.marcaAccesorio || datosTecnicos.modeloSerieAccesorio">
                                <hr>
                                <p><strong>Accesorios:</strong> {{ datosTecnicos.accesorios }}</p>
                                <p><strong>Marca Accesorios:</strong> {{ datosTecnicos.marcaAccesorio }}</p>
                                <p><strong>Modelo/Serie Accesorios:</strong> {{ datosTecnicos.modeloSerieAccesorio }}
                                </p>
                            </div>

                            <hr>
                            <strong>Fuentes de Alimentación:</strong>
                            <ul>
                                <li *ngIf="datosTecnicos.agua">Agua</li>
                                <li *ngIf="datosTecnicos.aire">Aire</li>
                                <li *ngIf="datosTecnicos.vapor">Vapor</li>
                                <li *ngIf="datosTecnicos.derivadoPetroleo">Derivados Petróleo</li>
                                <li *ngIf="datosTecnicos.electricidad">Electricidad</li>
                                <li *ngIf="datosTecnicos.energiaSolar">Energía Solar</li>
                                <li *ngIf="datosTecnicos.otros">Otros: {{ datosTecnicos.otros }}</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- SECCION 5: REGISTRO DE APOYO -->
                <div class="col-md-6 mb-4" *ngIf="registroApoyo">
                    <div class="card h-100">
                        <div class="card-header bg-light"><strong>Registro de Apoyo</strong></div>
                        <div class="card-body">
                            <p><strong>Manual de Usuario:</strong> {{ registroApoyo.manualUsuario ? 'Si' : 'No' }}</p>
                            <p><strong>Manual Técnico:</strong> {{ registroApoyo.manualTecnico ? 'Si' : 'No' }}</p>
                            <p><strong>Equipo Fijo:</strong> {{ registroApoyo.equipoFijo ? 'Si' : 'No' }}</p>
                            <p><strong>Uso:</strong> {{ registroApoyo.uso }}</p>
                            <p><strong>Riesgo:</strong> {{ registroApoyo.riesgo }}</p>
                            <p><strong>Tecnología:</strong> {{ registroApoyo.tecnologiaPredominante }}</p>
                            <p><strong>Clasificación:</strong> {{ registroApoyo.clasificacion }}</p>
                            <p><strong>Estado Físico:</strong> {{ registroApoyo.estado }}</p>
                            <p><strong>Mantenimiento:</strong> {{ registroApoyo.mantenimiento }}</p>
                            <p><strong>Propiedad:</strong> {{ registroApoyo.propiedad }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- SECCION 6: DOCUMENTOS ANEXOS -->
                <div class="col-12 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <strong>Documentos Anexos</strong>
                            <div class="d-flex align-items-center">
                                <label for="fileUpload" class="btn btn-primary btn-sm me-2"
                                    [class.disabled]="uploading">
                                    <i class="bi bi-upload me-2"></i>{{ uploading ? 'Subiendo...' : 'Subir Documento' }}
                                </label>
                                <input type="file" id="fileUpload" class="d-none" (change)="onFileSelected($event)"
                                    accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.png">
                            </div>
                        </div>
                        <div class="card-body">
                            <div *ngIf="documentos.length === 0" class="text-center text-muted py-3">
                                No hay documentos adjuntos.
                            </div>
                            <div class="table-responsive" *ngIf="documentos.length > 0">
                                <table class="table table-hover align-middle">
                                    <thead>
                                        <tr>
                                            <th>Nombre Archivo</th>
                                            <th>Fecha Carga</th>
                                            <th class="text-end">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let doc of documentos">
                                            <td>
                                                <i class="bi bi-file-earmark-text me-2"></i>{{ doc.nombreOriginal }}
                                            </td>
                                            <td>{{ doc.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
                                            <td class="text-end">
                                                <button class="btn btn-sm btn-outline-primary me-2"
                                                    (click)="descargarDocumento(doc.id)" title="Descargar/Ver">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger"
                                                    (click)="eliminarDocumento(doc.id)" title="Eliminar">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>