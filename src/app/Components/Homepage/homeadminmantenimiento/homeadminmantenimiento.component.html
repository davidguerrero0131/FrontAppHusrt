<div style="margin-top: 3%; margin-left: 5%; margin-right: 5%; background-color: white;">
</div>

<div class="card border-0 shadow-sm rounded-0 mb-4 bg-white">
    <app-mantenimientoadminnavbar></app-mantenimientoadminnavbar>
</div>

<div style="margin-bottom: 2%;">
    <h1 style="text-align: center;">MANTENIMIENTO DE ÁREAS FÍSICAS</h1>
</div>

<div class="filtromes flex flex-wrap align-items-center justify-content-center gap-3" style="margin-bottom: 2%;">

    <div class="flex align-items-center gap-2">
        <label class="font-bold">Año:</label>
        <input pInputText type="number" [(ngModel)]="anio" placeholder="YYYY" class="w-8rem" />
    </div>

    <div class="flex align-items-center gap-2">
        <label class="font-bold">Inicio:</label>
        <p-dropdown [options]="meses" [(ngModel)]="mesInicio" optionLabel="label" optionValue="value"
            placeholder="Mes Inicio" [style]="{'width':'10rem'}"></p-dropdown>
    </div>

    <div class="flex align-items-center gap-2">
        <label class="font-bold">Fin:</label>
        <p-dropdown [options]="meses" [(ngModel)]="mesFin" optionLabel="label" optionValue="value" placeholder="Mes Fin"
            [style]="{'width':'10rem'}"></p-dropdown>
    </div>

    <button type="button" class="btn btn-dark" (click)="setDate()">
        Buscar
    </button>
</div>

<div>
    <h6 style="text-align: center;" *ngIf="mesInicio === mesFin">
        Mantenimientos del mes de {{obtenerNombreMes(mesInicio)}} del año {{anio}}
    </h6>
    <h6 style="text-align: center;" *ngIf="mesInicio !== mesFin">
        Mantenimientos de {{obtenerNombreMes(mesInicio)}} a {{obtenerNombreMes(mesFin)}} del año {{anio}}
    </h6>
</div>

<div class="text-center mb-4">
    <div class="btn-group botonesMenu" role="group" aria-label="Basic example">
        <button type="button" class="btn" [ngClass]="panelPreventivos ? 'btn-warning' : 'btn-dark'"
            (click)="viewPreventivos()">
            Preventivos
        </button>

        <button type="button" class="btn" [ngClass]="panelMetas ? 'btn-warning' : 'btn-dark'" (click)="viewMetas()">
            Metas
        </button>

        <button type="button" class="btn" [ngClass]="panelCorrectivos ? 'btn-warning' : 'btn-dark'"
            (click)="viewCorrectivos()">
            Correctivos
        </button>
    </div>
</div>

<div style="margin-top: 1%;" class="container-fluid px-5">
    <div class="panelMantenimientos" *ngIf="panelPreventivos">

        <div class="card">
            <p-table #dt2 [value]="preventivos" dataKey="id" [rows]="10" [rowsPerPageOptions]="[10, 25, 50, 100]"
                [loading]="loading" [paginator]="true" [tableStyle]="{ 'min-width': '10rem' }"
                [globalFilterFields]="['area.nombre', 'area.ubicacion']">

                <ng-template pTemplate="caption">
                    <div class="flex">
                        <p-iconfield iconPosition="left" class="ml-auto">
                            <p-inputicon>
                                <i class="pi pi-search"></i>
                            </p-inputicon>
                            <input pInputText type="text"
                                (input)="dt2.filterGlobal($any($event.target).value, 'contains')"
                                placeholder="Búsqueda General" />
                        </p-iconfield>
                    </div>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr>
                        <th style="width:20%; align-items: center; text-align: center">Área</th>
                        <th style="width:20%; align-items: center; text-align: center">Ubicación</th>
                        <th style="width:15%; align-items: center; text-align: center">Mes</th>
                        <th style="width:15%; align-items: center; text-align: center">Estado</th>
                        <th style="width:15%; align-items: center; text-align: center">Opciones</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-plan>
                    <tr>
                        <td style="text-align: center;">
                            {{ plan.area?.nombre || 'Sin Nombre' }}
                        </td>
                        <td style="text-align: center;">
                            {{ plan.area?.ubicacion || 'Sin Ubicación' }}
                        </td>
                        <td style="text-align: center;">
                            {{ plan.mesNombre }}
                        </td>
                        <td style="text-align: center;">
                            <span
                                [class]="'badge ' + (plan.estado === 3 ? 'bg-success' : (plan.estado === 0 ? 'bg-danger' : 'bg-warning'))">
                                {{ plan.estado === 3 ? 'Completado' : (plan.estado === 0 ? 'Cancelado' : 'Pendiente') }}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            <!-- Placeholder for actions -->
                            <button pButton icon="pi pi-eye"
                                class="p-button-rounded p-button-info p-button-sm"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="text-center">No hay Planes para este periodo.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <div class="panelMantenimientos" *ngIf="panelMetas">
        <div class="row">
            <div class="col-md-2">
                <button type="button" class="btn btn-sm" [ngClass]="panelRealizados ? 'btn-warning' : 'btn-dark'"
                    style="width: 100%; margin-bottom: 2%;" (click)="panelRealizadosView()">
                    Realizados
                </button>
                <button type="button" class="btn btn-sm" [ngClass]="panelPendientes ? 'btn-warning' : 'btn-dark'"
                    style="width: 100%;" (click)="panelPendientesView()">
                    Pendientes
                </button>
            </div>
            <div class="col-md-10" *ngIf="panelRealizados">
                <div class="card">
                    <!-- Table for Realizados (Reuse structure or filtered data) -->
                    <p-table [value]="realizados" [rows]="10" [paginator]="true">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Área</th>
                                <th>Mes</th>
                                <th>Estado</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-plan>
                            <tr>
                                <td>{{ plan.area?.nombre }}</td>
                                <td>{{ plan.mesNombre }}</td>
                                <td><span class="badge bg-success">Completado</span></td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="3" class="text-center">No hay planes realizados.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
            <div class="col-md-10" *ngIf="panelPendientes"
                style="background-color: #d1e7dd; padding: 1rem; border-radius: 0.5rem;">
                <div class="card">
                    <!-- Table for Pendientes -->
                    <p-table [value]="pendientes" [rows]="10" [paginator]="true">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Área</th>
                                <th>Mes</th>
                                <th>Estado</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-plan>
                            <tr>
                                <td>{{ plan.area?.nombre }}</td>
                                <td>{{ plan.mesNombre }}</td>
                                <td><span class="badge bg-warning">Pendiente</span></td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="3" class="text-center">No hay planes pendientes.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </div>
    </div>

    <div class="panelMantenimientos" *ngIf="panelCorrectivos">
        <div class="card">
            <div class="card-body text-center">
                <h3>Módulo de Correctivos en Construcción</h3>
            </div>
        </div>
    </div>
</div>