<div class="card">
    <div class="flex justify-content-between align-items-center mb-4">
        <div class="flex align-items-center gap-2">
            <button pButton icon="pi pi-arrow-left" (click)="backToDashboard()"
                class="p-button-text p-button-rounded mr-2" pTooltip="Volver a Inventario"></button>
            <h2 class="m-0 text-primary font-bold">Asignación de Elementos por Área</h2>
        </div>
    </div>

    <!-- Filtros Globales -->
    <div class="flex justify-content-end mb-3">
        <span class="p-input-icon-left w-full md:w-auto">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                placeholder="Buscar área" class="w-full" />
        </span>
    </div>

    <p-table #dt [value]="areas" [rows]="10" [paginator]="true" [loading]="loading"
        [globalFilterFields]="['nombre', 'ubicacion']" responsiveLayout="scroll"
        styleClass="p-datatable-striped p-datatable-sm shadow-1 border-round-lg" [rowHover]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} entradas"
        [showCurrentPageReport]="true">

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">#</th>
                <th pSortableColumn="nombre">Área <p-sortIcon field="nombre"></p-sortIcon></th>
                <th pSortableColumn="ubicacion">Ubicación <p-sortIcon field="ubicacion"></p-sortIcon></th>
                <th>Elementos Asignados</th>
                <th pSortableColumn="cantidadElementos">Cantidad <p-sortIcon field="cantidadElementos"></p-sortIcon>
                </th>
                <th style="width: 10rem">Acciones</th>
            </tr>
            <tr>
                <th></th>
                <th>
                    <p-columnFilter type="text" field="nombre" placeholder="Filtrar Área"></p-columnFilter>
                </th>
                <th>
                    <p-columnFilter type="text" field="ubicacion" placeholder="Filtrar Ubicación"></p-columnFilter>
                </th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-area let-rowIndex="rowIndex">
            <tr>
                <td class="font-bold">{{ rowIndex + 1 }}</td>
                <td>
                    <div class="font-bold text-lg mb-1">{{ area.nombre }}</div>
                    <div class="text-500 text-sm">{{ area.descripcion || 'Sin descripción' }}</div>
                </td>
                <td>
                    <span class="p-tag p-tag-rounded"
                        [ngClass]="{'bg-cyan-500': area.ubicacion === 'Torre 1', 'bg-orange-500': area.ubicacion === 'Torre 2'}">
                        {{ area.ubicacion || 'N/A' }}
                    </span>
                </td>
                <td>
                    <div *ngIf="area.elementosAsignados && area.elementosAsignados.length > 0; else noElements">
                        <p-tag *ngFor="let el of area.elementosAsignados" [value]="el" severity="secondary"
                            styleClass="mr-1 mb-1"></p-tag>
                    </div>
                    <ng-template #noElements>
                        <span class="text-500 font-italic">
                            <i class="pi pi-info-circle mr-1"></i>Sin elementos asignados
                        </span>
                    </ng-template>
                </td>
                <td>
                    <span class="p-badge p-badge-lg"
                        [ngClass]="{'p-badge-success': area.cantidadElementos > 0, 'p-badge-secondary': area.cantidadElementos === 0}">
                        {{ area.cantidadElementos }}
                    </span>
                </td>
                <td>
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-info mr-1"
                        (click)="gestionar(area.id)" pTooltip="Gestionar / Editar"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger"
                        (click)="eliminarAsignaciones(area.id)" pTooltip="Limpiar Asignaciones"
                        [disabled]="area.cantidadElementos === 0"></button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4" class="text-center p-4">No se encontraron áreas.</td>
            </tr>
        </ng-template>
    </p-table>
</div>