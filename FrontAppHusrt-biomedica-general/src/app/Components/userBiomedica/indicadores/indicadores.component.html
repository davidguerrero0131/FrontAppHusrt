<div class="dashboard-container surface-ground min-h-screen p-3">

  <!-- Header / Filtros -->
  <div class="card border-0 shadow-sm border-round-xl surface-card p-3 mb-3">
    <div class="flex flex-column lg:flex-row justify-content-between align-items-center gap-3">

      <!-- Título y Filtros -->
      <div class="flex flex-column md:flex-row gap-3 align-items-center w-full lg:w-auto">
        <label class="text-lg font-bold text-700">INDICADORES BIOMÉDICA</label>

        <div class="flex align-items-center gap-2 surface-100 p-2 border-round-lg">
          <div class="flex flex-column">
            <span class="text-xs text-500 font-semibold ml-1">Año</span>
            <input pInputText type="number" [(ngModel)]="anio"
              class="p-inputtext-sm w-5rem border-0 bg-transparent font-bold" (change)="refrescar()">
          </div>
          <div class="w-1px bg-300 h-2rem"></div>
          <div class="flex flex-column">
            <span class="text-xs text-500 font-semibold ml-1">Desde</span>
            <p-dropdown [options]="meses" [(ngModel)]="mesInicio" optionLabel="label" optionValue="value"
              styleClass="p-inputtext-sm border-0 bg-transparent w-8rem text-sm" (onChange)="refrescar()"></p-dropdown>
          </div>
          <div class="w-1px bg-300 h-2rem"></div>
          <div class="flex flex-column">
            <span class="text-xs text-500 font-semibold ml-1">Hasta</span>
            <p-dropdown [options]="meses" [(ngModel)]="mesFin" optionLabel="label" optionValue="value"
              styleClass="p-inputtext-sm border-0 bg-transparent w-8rem text-sm" (onChange)="refrescar()"></p-dropdown>
          </div>
        </div>

        <button pButton icon="pi pi-sync" (click)="refrescar()"
          class="p-button-rounded p-button-text p-button-secondary"></button>
      </div>

      <!-- Totales -->
      <div class="flex align-items-center gap-3">
        <span *ngIf="loading()" class="text-primary text-sm font-medium flex align-items-center gap-2">
          <i class="pi pi-spin pi-spinner"></i> Actualizando...
        </span>
        <div class="surface-100 px-4 py-2 border-round-2xl">
          <span class="text-500 text-sm font-semibold mr-2">Total Reportes</span>
          <span class="text-xl font-bold text-900">{{ reportes().length }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="grid" *ngIf="indicadoresData()">

    <!-- Fila 1: KPIs Principales (Preventivo/Correctivo/Tiempos) -->
    <div class="col-12 lg:col-4">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full flex flex-column">
        <div class="flex align-items-center justify-content-between mb-3">
          <span class="text-lg font-bold text-700 flex align-items-center gap-2">
            <i class="pi pi-shield text-green-500"></i> Preventivo
          </span>
          <span class="text-xs font-medium bg-green-50 text-green-600 px-2 py-1 border-round">Cumplimiento: {{
            preventivoInfo().cumplimiento }}%</span>
        </div>

        <div class="flex align-items-center gap-3 mb-3">
          <div class="flex-1 surface-50 p-2 border-round text-center">
            <div class="text-xs text-500 font-bold mb-1">PROGRAMADOS</div>
            <div class="text-xl font-bold text-900">{{ preventivoInfo().programados }}</div>
          </div>
          <div class="flex-1 surface-50 p-2 border-round text-center">
            <div class="text-xs text-500 font-bold mb-1">REALIZADOS</div>
            <div class="text-xl font-bold text-green-600">{{ preventivoInfo().realizados }}</div>
          </div>
        </div>
        <p-meterGroup [value]="preventivoMeterData()" labelPosition="start" [max]="100"
          styleClass="w-full text-xs"></p-meterGroup>
      </div>
    </div>

    <div class="col-12 lg:col-4">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full flex flex-column">
        <div class="flex align-items-center justify-content-between mb-3">
          <span class="text-lg font-bold text-700 flex align-items-center gap-2">
            <i class="pi pi-wrench text-blue-500"></i> Correctivo
          </span>
          <span class="text-xs font-medium bg-blue-50 text-blue-600 px-2 py-1 border-round">Eficiencia</span>
        </div>

        <div class="flex align-items-center gap-3 mb-3">
          <div class="flex-1 surface-50 p-2 border-round text-center">
            <div class="text-xs text-500 font-bold mb-1">REPORTADOS</div>
            <div class="text-xl font-bold text-900">{{ correctivoInfo().reportados }}</div>
          </div>
          <div class="flex-1 surface-50 p-2 border-round text-center">
            <div class="text-xs text-500 font-bold mb-1">ATENDIDOS</div>
            <div class="text-xl font-bold text-blue-600">{{ correctivoInfo().realizados }}</div>
          </div>
        </div>
        <p-meterGroup [value]="correctivoMeterData()" labelPosition="start" [max]="100"
          styleClass="w-full text-xs"></p-meterGroup>
      </div>
    </div>

    <div class="col-12 lg:col-4">
      <div
        class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full flex flex-column justify-content-center">
        <span class="text-lg font-bold text-700 mb-2 block">Duración Promedio</span>
        <div class="flex gap-3 h-full">
          <div
            class="flex-1 bg-green-50 border-round-xl p-3 flex flex-column align-items-center justify-content-center">
            <span class="text-sm text-green-700 font-medium mb-1">Preventivo</span>
            <span class="text-2xl font-black text-green-700">{{ duracionStats().preventivo }}</span>
            <span class="text-xs text-green-600 mt-1">hh:mm:ss</span>
          </div>
          <div class="flex-1 bg-blue-50 border-round-xl p-3 flex flex-column align-items-center justify-content-center">
            <span class="text-sm text-blue-700 font-medium mb-1">Correctivo</span>
            <span class="text-2xl font-black text-blue-700">{{ duracionStats().correctivo }}</span>
            <span class="text-xs text-blue-600 mt-1">hh:mm:ss</span>
          </div>
        </div>
      </div>
    </div>



    <!-- Fila 3: Distribuciones (Grid más denso) -->

    <div class="col-12 lg:col-8">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Actividad por Responsable</h5>
        <div style="height: 350px;">
          <p-chart type="bar" [data]="porUsuarioChartData()" [options]="getResponsableOptions()"></p-chart>
        </div>
      </div>
    </div>

    <div class="col-12 lg:col-4">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Por Tipo</h5>
        <div class="flex justify-content-center align-items-center" style="height: 350px;">
          <p-chart type="doughnut" [data]="porTipoChartData()" [options]="chartOptions()"></p-chart>
        </div>
      </div>
    </div>

    <!-- Fila 4: Detalles -->
    <div class="col-12 md:col-6">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Top 5 Servicios con más Correctivos</h5>
        <div style="height: 300px;">
          <p-chart type="bar" [data]="porServicioChartData()" [options]="barOptions()"></p-chart>
        </div>
      </div>
    </div>

    <div class="col-12 md:col-6">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Reportes por Falla</h5>
        <div style="height: 300px;">
          <p-chart type="bar" [data]="porFallaChartData()" [options]="barOptions()"></p-chart>
        </div>
      </div>
    </div>

    <!-- Fila 5: Preventivos vs Correctivos por Equipo (Side by Side) -->
    <div class="col-12 md:col-6">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Preventivos por Tipo de Equipo</h5>
        <div style="height: 250px;">
          <p-chart type="bar" [data]="preventivoPorTipoEquipoChartData()" [options]="barOptions()"></p-chart>
        </div>
      </div>
    </div>

    <div class="col-12 md:col-6">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Correctivos por Tipo de Equipo</h5>
        <div style="height: 250px;">
          <p-chart type="bar" [data]="correctivoPorTipoEquipoChartData()" [options]="barOptions()"></p-chart>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card border-0 shadow-sm border-round-xl surface-card p-3 h-full">
        <h5 class="text-lg font-bold text-800 mb-3">Top 10 Equipos con más Reportes</h5>
        <div style="height: 350px;">
          <p-chart type="bar" [data]="topEquiposChartData()" [options]="barOptions()"></p-chart>
        </div>
      </div>
    </div>

  </div>
</div>